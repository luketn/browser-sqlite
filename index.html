<meta charset="utf8" />
<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.min.js"></script>
<script>
    config = {
        locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${filename}`
    }
    let dateTime = () => new Date().toDateString() + ":" + new Date().getHours() + ":" + new Date().getMinutes() + ":" + new Date().getSeconds();

    console.log(`${dateTime()}: Initialising...` );
    const getData = async () => {
        let response = await fetch('https://swapi.dev/api/people');
        let data = await response.json();
        console.log(`${dateTime()}: Loaded ${data.count} people` );

        // The `initSqlJs` function is globally provided by all of the main dist files if loaded in the browser.
        // We must specify this locateFile function if we are loading a wasm file from anywhere other than the current html page's folder.
        initSqlJs(config).then(function(SQL){
            console.log(`${dateTime()}: SQL is loaded`);

            //Create the database
            const db = new SQL.Database();

            // Run a query without reading the results
            db.run("CREATE TABLE people (name char, height int, gender char);");

            // Insert two rows: (1,111) and (2,222)
            for (const person of data.results) {
                db.run("INSERT INTO people VALUES (?,?,?)", [person.name, person.height, person.gender]);
            }

            console.log(`${dateTime()}: Inserted ${data.results.length} people` );

            // Prepare a statement
            const stmt = db.prepare("SELECT * FROM people");
            while(stmt.step()) { //
                const row = stmt.getAsObject();
                console.log('Here is a row: ' + JSON.stringify(row));
            }
        });
    }
    getData();

</script>
<body>
Output is in Javascript console
</body>
</html>
